<!DOCTYPE html><html lang="en" ><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Mapping English and Welsh House Prices in R" /><meta property="og:locale" content="en_US" /><meta name="description" content="Mapping English and Welsh House Prices in R" /><meta property="og:description" content="Mapping English and Welsh House Prices in R" /><link rel="canonical" href="http://localhost:4000/2022/06/24/mapping-uk-house-prices-in-r" /><meta property="og:url" content="http://localhost:4000/2022/06/24/mapping-uk-house-prices-in-r" /><meta property="og:site_name" content="Scott’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-24T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Mapping English and Welsh House Prices in R" /><meta name="twitter:site" content="@" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-24T00:00:00+01:00","datePublished":"2022-06-24T00:00:00+01:00","description":"Mapping English and Welsh House Prices in R","headline":"Mapping English and Welsh House Prices in R","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2022/06/24/mapping-uk-house-prices-in-r"},"url":"http://localhost:4000/2022/06/24/mapping-uk-house-prices-in-r"}</script><title> Mapping English and Welsh House Prices in R - Scott&#39;s Blog</title><link rel="shortcut icon" href="/favicon.png"><link rel="alternate" type="application/atom+xml" title="Scott's Blog" href="/atom.xml"><link rel="alternate" type="application/json" title="Scott's Blog" href="http://localhost:4000/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="/sitemap.xml" /><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:system-ui, sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.5;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code,pre{background:#ecedee}code{padding:.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:2rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}figcaption{font-size:smaller}</style></head><body><main role="main"><header role="banner"> <!--<h1 class="logo">Scott's Blog</h1>--><nav role="navigation"><ul><li><a href="/" >Posts</a></li><li><a href="/about" >About</a></li><li><a href="/search" >Search</a></li></ul></nav></header><section class="post"><h2>Mapping English and Welsh House Prices in R</h2><h2 id="introduction">Introduction</h2><p>House prices are constantly in the news. However, basically any news story I’ve read about house prices doesn’t really focus on very granular data - usually talking about the country overall, or dividing by region and perhaps doing a deep dive into a specific locality. The focus of the post is to look at house prices at a very local level, which 1) should hopefully show some interesting trends and 2) allows me to learn a bit about making interactive maps in R.</p><h2 id="data">Data</h2><p>The data on house prices was taken from the April? or May release of the “Prices Paid” dataset, collected by HM Land Registry. This is a dataset of all registered property sales in England &amp; Wales from 1995 to present. It contains information on the price paid for each property as well as the postcode, address and other info (e.g. property type, new build/old build). Ideally, I wanted to get data for the whole of the UK, but Scotland does not provide this data in an easily accessible manner (as far as I know) and any property data for Northern Ireland apparently requires a paid license to access, so I was left with just English and Welsh data.</p><p>To map this data, I needed to match the postcodes to geographic coordinates and geographic areas. I used the ONS National Postcode Lookup to do this. The Postcode Lookup details every postcode in the UK and their associated latitude/longitude as well as the geographic areas that they belong to (e.g. Local Authority District, Middle Super Output Area).</p><p>Some other important datasets I needed for creating some of the maps were the shapefiles for the geographic areas I wanted to look at, which were also from the ONS.</p><p>One final dataset is from the House of Commons (HoC) Library. For Middle Super Output Areas (MSOA) - which is an area type I wanted to visualise, they generally don’t have names and are just named based on their local authority district (e.g.Great Yarmouth 1, Great Yarmouth 2), however the HoC Library has devised actual descriptive names for these areas (e.g. Hemsby &amp; Oremsby, Fleggburgh/ Rollesby &amp; Martham), which are a bit nicer for presenting and analysing the data at a MSOA level.</p><h2 id="general-method">General Method</h2><p>Due to reporting time lags, it’s generally not best practice to look at data from the last few months, so I only looked at data up to March 2022. This should hopefully reduce the impact of reporting lags, while also providing fairly up to date figures. Because I am drilling down into rather small areas, just using sales from say March 2022 would lead to a very small sample size for a lot of areas, which wouldn’t be very accurate. So I decided to look at the median price over the whole year for each area - March 2021 - March 2022. I didn’t adjust for property type mix as a lot of house price indexes do, instead opting to look at the unadjusted values.</p><p>I also decided to bin the price/sale values, as I think it makes it easier to interpret the difference in price between areas. The bins I used were generally not equal width, but instead were somewhat similar to log scales, where larger values had larger bins, to reduce the total number of bins, while not crowding out the lower prices areas like a continuous legend would.</p><p>I wanted to make the maps interactive, so I used the Leaflet package in R, which is build on top of the Leaflet JavaScript library. There are quite a lot of more advanced features and tricks in the Leaflet package that I tried to make the most of, e.g. adding dynamic lables, using multiple basemaps to show location labels on top of the polygon layers and having multiple polygon layers that are only visible at different zoom levels.</p><h3 id="chloropleth-maps">Chloropleth maps</h3><p>the first maps type I looked at was a chloropleth, shown below. The map initially shows median house prices and the number of sales at a Local Authority District (LAD) Level of granularity. However if you zoom in, it will break the LADs down to MSOAs (essentially one layer below - ignoring wards as they don’t match perfectly). This allows you to get a broader and less crowded view at the national level and still explore regional variations at a high level of granularity.</p><div style="width:100%;border:none"><iframe src="/assets/widgets/house-prices/chloropleth.html" width="100%" height="500px" frameborder="0"></iframe></div><details> <summary> Click here for the code that was used to generate this map </summary><pre><code class="language-r">    chloropleth &lt;-  leaflet() %&gt;%  
        setView(lng = -0.5, lat = 53.25, zoom = 6.00) %&gt;% 
        addMapPane("background", zIndex = 100) %&gt;% 
        addMapPane("data", zIndex = 101) %&gt;% 
        addMapPane("labels", zIndex = 102) %&gt;% 
        addProviderTiles(providers$CartoDB.PositronNoLabels, 
                            options = providerTileOptions(pane = "background", minZoom = 6)) %&gt;% 
        addPolygons(data = msoa_leaflet_change,fillColor = ~pal(msoa_leaflet_change$price_bins_post), stroke = TRUE, color = "white",weight = 0.75, fillOpacity = 0.75,
                    label = labels, group = "x", options = pathOptions(pane = "data")) %&gt;% 
        addPolygons(data = lad_leaflet_change, fillColor = ~pal(lad_leaflet_change$price_bins_post), stroke = TRUE, color = "white",weight = 0.75, fillOpacity = 0.75,
                    group = "y", label = labels_x, options = pathOptions(pane = "data")) %&gt;% 
        addProviderTiles(providers$CartoDB.PositronOnlyLabels, 
                            options = providerTileOptions(pane = "labels",minZoom = 6)) %&gt;% 
        groupOptions("x", zoomLevels = 11:20) %&gt;% 
        groupOptions("y", zoomLevels = 0:10) %&gt;% 
        addLegend("bottomright", pal = pal, values = c("0-150k", "150k-250k", "250k-350k", "350k-450k", "450k-750k", "750k-1m", "Above 1m"))
    saveWidget(chloropleth, "Widgets/chloropleth.html")
</code></pre></details><p><br /></p><h3 id="grid-maps">Grid maps</h3><p>There are also a couple of functions in the sf package that can be used to divide an area into equal sized grid squares and then summarise the data within each grid square.</p><p>insert code and description of how this was done</p><p>The grid squares I used are supposedly 25km^2 for the England and Wales maps and 0.75km^2 for the London map (see both below). Leaflet uses the “Web Mercator” coordinate referencing system (CRS) (3875) to display maps, which essentially flattens maps to make them look nice for the web. However, it does this at the expense of accurate distances, which get worse the further you move from the equator and the UK is quite far from the ecuator. This makes me question how accurate these grid square sizes are. It would probably be better to use a CRS like the UK National Grid (27700), which does not distort distances like the Web Mercator CRS, but leaflet doesn’t support this, atleast not if you want to use pretty basemaps.</p><p>In any case, these grid squares be used to create quite detailed and cool maps of house prices and house sales. The main differences compared to chloropleth maps are that grid maps don’t say anything about population density/property density and because of this there are quite a lot of grid-squares with just a few observations, which may impact the reliability of median prices and could be misleading. At the same time, using equally sized grid-squares does allow for a more granular view of the actual house prices and sales across the country, which can reveal insight which may be hidden by using other map types. e.g. you can see a few grid squares with very highly priced properties but only 1 or 2 sales above Erith in the London map below.</p><p>Below you can see maps of the UK, coloured firstly by property price and secondly by number of sales.</p><div style="width:100%;border:none"><iframe src="/assets/widgets/house-prices/price_grid.html" width="100%" height="500px" frameborder="0"></iframe></div><div style="width:100%;border:none"><iframe src="/assets/widgets/house-prices/sales_grid2.html" width="100%" height="500px" frameborder="0"></iframe></div><p>I also created a grid map just for London, as London has a high population (~8.9 million) and a whole bunch of regional inequalities. I therefore thought it would be interesting to visualise it individually. I also added a few more colours to the colour scale and legend to capture the very pricy areas of the Capital.</p><div style="width:100%;border:none"><iframe src="/assets/widgets/house-prices/london_grid2.html" width="100%" height="500px" frameborder="0"></iframe></div><h3 id="point-grid-maps">Point-grid maps</h3><p>Additionally, the st_centroid function can be used to find the centre of each grid-square. From this we can create what I’ve called “point-grid” maps (not sure if there is an actual name for this kind of map, but I have seen some other examples). These maps can use both colour and size scales to show both total sales and median price, which isn’t shown in the other maps here. The drawdown of this type of map is that it can become harder to see the individual points in high turnover area e.g. London or Birmingham, due to overlapping points.</p><div style="width:100%;border:none"><iframe src="/assets/widgets/house-prices/point_grid.html" width="100%" height="500px" frameborder="0"></iframe></div><div style="width:100%;border:none"><iframe src="/assets/widgets/house-prices/log_point_grid.html" width="100%" height="500px" frameborder="0"></iframe></div><span class="meta"><time datetime="2022-06-24T00:00:00+01:00">June 24, 2022</time> &middot; <a href="/tag/R">R</a>, <a href="/tag/Leaflet">Leaflet</a></span></section></main></body></html>
