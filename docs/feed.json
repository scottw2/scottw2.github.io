{
    "version": "https://jsonfeed.org/version/1",
    "title": "Scott&apos;s Blog",
    "home_page_url": "http://localhost:4000/",
    "feed_url": "http://localhost:4000/feed.json",
    "description": "A blog of data analytics and its applications.",
    "icon": "http://localhost:4000/apple-touch-icon.png",
    "favicon": "http://localhost:4000/favicon.ico",
    "expired": false,
    
    "author": "{"twitter"=>nil, "name"=>nil, "avatar"=>nil, "email"=>nil, "url"=>nil}",
    
"items": [
    
        {
            "id": "http://localhost:4000/2022/07/16/a-few-charts-on-eu-energy",
            "title": "A Few Charts on EU Energy",
            "summary": "A Few Charts on EU Energy",
            "content_text": "IntroductionThe motivation for this post was to create some minimalist visualisations that tell a bit of a story. I thought energy supplies in the EU would be an interesting topic as I wanted to do something somewhat geographical and topical.A Quite Long Note on Methodology and DefinitionsThe majority of the data used here is from the EU’s energy balances on Eurostat. While Eurostat’s energy data has good coverage, it isn’t initially intuitive to understand. Eurostat provide a number of measures of energy supply and consumption at different stages of the energy transformation and consumption process. There are a variety of measures of production and primary energy consumption, notably, Total Energy Supply (TES), which measures the total amount of energy needed to satisfy all domestic energy needs for a country, including losses and consumption from energy transformation, distribution and transmission. (energy from primary production + imports - exports + recovered/recycled products + stock changes - international maritime bunkers &amp; aviation). There are also a couple of other definition of primary energy consumption e.g. Gross Available Energy (GAE) &amp; Gross Inland Energy Consumption (GIC). The differences from TES are that GAE includes both international maritime bunkers and aviation and GIC included international aviation, and thus both include some energy not technically used for each country’s domestic energy needs - therefore I felt TES was a better measure to use to show each country’s energy usage. See here for extra information on Eurostat’s energy balance methodology.Ideally though I would want to use statistics of final energy consumption (i.e. energy balances after losses from transformation, distribution and transmission). However, the final energy consumption stats supplied by Eurostat don’t specify the original source (e.g. nuclear, renewables) - as they break down energy by it’s final form (e.g. electricity, gas etc…), so for example, you cannot then say what % of energy comes from nuclear sources and the % of energy from renewables ends up being vastly underestimated as a lot of this is counted as electricity or heat. Therefore, I used Total Energy Supply here, as it captures energy supply by it’s original source.Also note that the figures for renewables here use a slightly different definition than the figures that the EU base their renewables targets on. For their targets they look at “Gross Final Consumption of Energy” - which is final energy consmption (energy used in industry, transport, households… ) including electricity and heat losses from distribution and transmission, but excluding energy consumption and losses from transformation. It is also a definition that doesn’t appear in the EU’s energy balance data, which is a bit annoying. Additionally, some biofuels are not included if they don’t meet certain sustainability criteria, wind and hydro power have to apparently be normalised and there are some other technical differences from other metrics. The exact differences of these details are not particuarly clear e.g. it’s not very clear what biofuels are included and how wind and hydro are normalised. Finally, the figures given for this metric are only the % share of renewables in the energy mix and don’t break this down by the type of renewable energy (e.g. wind, solar). So because of this and to keep the analysis consistent with the rests of the data presented here, I have opted to look at renewables in the Total Energy Supply. See this page for more details on the differences between renewable energy definitions.The data for wind and solar power plants is from GlobalEnergyMonitor’s wind and solar plant databases. These seem to be the most up-to-date freely available renewable power plant databases with data for when each power plant started operating (around 90% of plants have operating date info). Note that this data does not include smaller power plants with under 10MWs of capacity for wind and under 20MWs for solar - which may disproportionately exlude power plants in smaller nations e.g. Cyprus, Malta. The World Resource Insitute also has another database of power plants, which shows those with lower MW capacities.Energy MixThe first thing we can look at is the energy mix of each nation (i.e. the energy supply broken down by energy source). Figure 1 shows the supply by each source as a % of the total energy supply.Most EU countries supply the majority of their energy supply from fossil fuels, but there is still quite a wide variation in energy mixes across the EU. For example, a number of nations are still relatively reliant on coal power (Poland, Bulgaria, Czechia, Germany). Others have over 50% of their energy supply originating from Oil &amp; Petroleum (Estonia, Cyprus, Luxembourg). In the case of Estonia this is due to their domestic shale mining operations. Contrastingly, there are nations that have a large amount of energy from renewables (Sweden, Finland, Latvia). You can also see other nations with a lot of nuclear in their energy mix, especially in Central and Eastern Europe (France, Bulgaria, Slovenia, Slovakia).Figure 1: Energy Mix in the EUFigure 3 shows how each country’s energy mixes have changed over time, between 1990 and 2000. In basically every nation we can see the decline of fossil fuels as renewable adoption has increased. There has also been an increase in energy derived from natural gas in quite a few states (e.g. Spain, Germany, Ireland, Belgium), as higher gas usage has substituted for lower coal usage as countries have phased out coal power plants. The % of energy from nuclear power has been fairly consistent over time in some nations (e.g. in France, Bulgaria,Hungary). In other countries it has grown (Slovakia and Czechia), while in states like Denmark and Belgium it has shrunk. Lithuania has a very unique graph, with nuclear disappearing entierly from their energy mix in 2009. This was due to the shutdown of the last active reactor at the Ignalina Nuclear powerplant, which was an old soviet plant and had a similar design to the one at Chernobyl. Of particular concern, the plant did not have a containment building to prevent radiation leaks in the event of emergencies, which made it rather dangerous to continue running. As part of Lithuania’s accession to the EU, it was agreed in 1999 that the plant would be wound down because of the risks posed by it.Figure 2: The EU’s Changing Energy SupplyRenewablesTo look in more detail at the rise of renewable energy in the EU, we can focus on the change in % of the energy supply coming from renewables between 1990 and 2020 in Figure 4 (note that the definition used here differs from the definition the EU uses for setting renewables targets - see above). In every EU country this has increased, but some much more than others. Sweden currently leads the way, with 52% of their energy supply from renewables, followed by Denmark and Finland. Denmark also have had the largest % change - from 6% to 40%. Additionally, quite a number of EU countries started with only 1, 2 or 3% of their energy from renewables sources, but have grown these to generally the double digits (e.g. Poland, Lithuania and Germany), which is good, but still lags far behind the leading nations.Figure 3: Renewables in the MixFrom which renewables sources is this energy coming from? Figure 6 below shows this below. This graph is sort of similar in design to Figure 2, but uses both axes to represent the % share, instead of just the x axis.In this graph we can also see the countries getting their renewable energy from each source. For example, we can see that a lot of countries are dominated by solid biofuels (Poland, Latvia, Finland), whereas others have a more diverse supply (Germany, Italy, Spain, France). It’s also not suprising to see a low % of solar in Nordic countries (Sweden, Finland), where they only get about 6 hours of sunlight in the winter, compared to sunnier more solar-panel-friendly Southern and Central European Nations (Spain, Netherlands, Greece, Cyprus).Italy has the largest share of geothermal in it’s renewable energy mix, while Ireland has the largest share and majority of it’s renewable energy coming from wind. Cyprus has the highest share of solar, and similarly Slovenia the higest for hydroelectric, Luxembourg for liquid biofuels and Germany for biogas.Figure 4: Who Uses What RenewablesFigure x shows the growth of the number of wind and solar power plants in Europe from 2000 to 2020. This chart shows the smaller installed capacity of solar compared to wind as well as the differences in distribution of wind and solar power plants (e.g Sweden &amp; Finland have a lot of wind plants but no solar plants or how Spanish wind plants are mostly in the north of the country and solar plants in the south). It also shows that wind power plants generally started operating earlier than solar, due to technology differences (this might also be partly because of the higher MW cutoff point in the solar database).Figure 5: The Growth of Solar and Wind Power",
            "content_html": "<h3 id=\"introduction\">Introduction</h3><!---add in EU27 into each grid - either top right or bottom left. Perhaps edit the grid to add in for each chart, instead of doing in illustrator. so some overall EU comments can be made.---><p>The motivation for this post was to create some minimalist visualisations that tell a bit of a story. I thought energy supplies in the EU would be an interesting topic as I wanted to do something somewhat geographical and topical.</p><h3 id=\"a-quite-long-note-on-methodology-and-definitions\">A Quite Long Note on Methodology and Definitions</h3><p>The majority of the data used here is from the EU’s energy balances on Eurostat. While Eurostat’s energy data has good coverage, it isn’t initially intuitive to understand. Eurostat provide a number of measures of energy supply and consumption at different stages of the energy transformation and consumption process. There are a variety of measures of production and primary energy consumption, notably, Total Energy Supply (TES), which measures the total amount of energy needed to satisfy all domestic energy needs for a country, including losses and consumption from energy transformation, distribution and transmission. (energy from primary production + imports - exports + recovered/recycled products + stock changes - international maritime bunkers &amp; aviation). There are also a couple of other definition of primary energy consumption e.g. Gross Available Energy (GAE) &amp; Gross Inland Energy Consumption (GIC). The differences from TES are that GAE includes both international maritime bunkers and aviation and GIC included international aviation, and thus both include some energy not technically used for each country’s domestic energy needs - therefore I felt TES was a better measure to use to show each country’s energy usage. See <a href=\"https://ec.europa.eu/eurostat/statistics-explained/index.php?title=Energy_balance_-_new_methodology\">here</a> for extra information on Eurostat’s energy balance methodology.</p><!---insert sankey graph of the EU energy balance flow.---><p>Ideally though I would want to use statistics of final energy consumption (i.e. energy balances after losses from transformation, distribution and transmission). However, the final energy consumption stats supplied by Eurostat don’t specify the original source (e.g. nuclear, renewables) - as they break down energy by it’s final form (e.g. electricity, gas etc…), so for example, you cannot then say what % of energy comes from nuclear sources and the % of energy from renewables ends up being vastly underestimated as a lot of this is counted as electricity or heat. Therefore, I used Total Energy Supply here, as it captures energy supply by it’s original source.</p><p>Also note that the figures for renewables here use a slightly different definition than the figures that the EU base their renewables targets on. For their targets they look at “Gross Final Consumption of Energy” - which is final energy consmption (energy used in industry, transport, households… ) including electricity and heat losses from distribution and transmission, but excluding energy consumption and losses from transformation. It is also a definition that doesn’t appear in the EU’s energy balance data, which is a bit annoying. Additionally, some biofuels are not included if they don’t meet certain sustainability criteria, wind and hydro power have to apparently be normalised and there are some other technical differences from other metrics. The exact differences of these details are not particuarly clear e.g. it’s not very clear what biofuels are included and how wind and hydro are normalised. Finally, the figures given for this metric are only the % share of renewables in the energy mix and don’t break this down by the type of renewable energy (e.g. wind, solar). So because of this and to keep the analysis consistent with the rests of the data presented here, I have opted to look at renewables in the Total Energy Supply. See <a href=\"https://ec.europa.eu/eurostat/statistics-explained/index.php?title=Calculation_methodologies_for_the_share_of_renewables_in_energy_consumption#Definition_of_the_primary_energy_content_of_fuels\">this page</a> for more details on the differences between renewable energy definitions.</p><!---The data for gas sources does not come from Eurostat as the Eurostat energy imports data doesn't properly take into account energy transfers (e.g. when some countries import more than 100% of their supply from Russia and then export some of this to other nations). Instead, this data comes from ACER - The EU Agency for the Cooperation of Energy Regulators, which I believe shows the original source of each EU country's gas supply (although I cannot find details of the precise methodology used to calculate this).---><p>The data for wind and solar power plants is from GlobalEnergyMonitor’s wind and solar plant databases. These seem to be the most up-to-date freely available renewable power plant databases with data for when each power plant started operating (around 90% of plants have operating date info). Note that this data does not include smaller power plants with under 10MWs of capacity for wind and under 20MWs for solar - which may disproportionately exlude power plants in smaller nations e.g. Cyprus, Malta. The World Resource Insitute also has <a href=\"https://blog.resourcewatch.org/2019/11/13/this-map-shows-29000-of-the-worlds-power-plants/\">another database</a> of power plants, which shows those with lower MW capacities.</p><h3 id=\"energy-mix\">Energy Mix</h3><p>The first thing we can look at is the energy mix of each nation (i.e. the energy supply broken down by energy source). Figure 1 shows the supply by each source as a % of the total energy supply.</p><p>Most EU countries supply the majority of their energy supply from fossil fuels, but there is still quite a wide variation in energy mixes across the EU. For example, a number of nations are still relatively reliant on coal power (Poland, Bulgaria, Czechia, Germany). Others have over 50% of their energy supply originating from Oil &amp; Petroleum (Estonia, Cyprus, Luxembourg). In the case of Estonia this is due to their domestic shale mining operations. Contrastingly, there are nations that have a large amount of energy from renewables (Sweden, Finland, Latvia). You can also see other nations with a lot of nuclear in their energy mix, especially in Central and Eastern Europe (France, Bulgaria, Slovenia, Slovakia).</p><p><img src=\"/assets/images/a-few-charts-on-eu-energy/energy-mix-fonts-2020-01-pink3-01-01.png\" alt=\"\" /><em>Figure 1: Energy Mix in the EU</em></p><p>Figure 3 shows how each country’s energy mixes have changed over time, between 1990 and 2000. In basically every nation we can see the decline of fossil fuels as renewable adoption has increased. There has also been an increase in energy derived from natural gas in quite a few states (e.g. Spain, Germany, Ireland, Belgium), as higher gas usage has substituted for lower coal usage as countries have phased out coal power plants. The % of energy from nuclear power has been fairly consistent over time in some nations (e.g. in France, Bulgaria,Hungary). In other countries it has grown (Slovakia and Czechia), while in states like Denmark and Belgium it has shrunk. Lithuania has a very unique graph, with nuclear disappearing entierly from their energy mix in 2009. This was due to the shutdown of the last active reactor at the Ignalina Nuclear powerplant, which was an old soviet plant and had a similar design to the one at Chernobyl. Of particular concern, the plant did not have a containment building to prevent radiation leaks in the event of emergencies, which made it rather dangerous to continue running. As part of Lithuania’s accession to the EU, it was agreed in 1999 that the plant would be wound down because of the risks posed by it.</p><p><img src=\"/assets/images/a-few-charts-on-eu-energy/energy-mix-fonts-10-01-01.png\" alt=\"\" /><em>Figure 2: The EU’s Changing Energy Supply</em></p><h3 id=\"renewables\">Renewables</h3><p>To look in more detail at the rise of renewable energy in the EU, we can focus on the change in % of the energy supply coming from renewables between 1990 and 2020 in Figure 4 (note that the definition used here differs from the definition the EU uses for setting renewables targets - see above). In every EU country this has increased, but some much more than others. Sweden currently leads the way, with 52% of their energy supply from renewables, followed by Denmark and Finland. Denmark also have had the largest % change - from 6% to 40%. Additionally, quite a number of EU countries started with only 1, 2 or 3% of their energy from renewables sources, but have grown these to generally the double digits (e.g. Poland, Lithuania and Germany), which is good, but still lags far behind the leading nations.</p><p><img src=\"/assets/images/a-few-charts-on-eu-energy/ren-line04-01.png\" alt=\"\" /><em>Figure 3: Renewables in the Mix</em></p><p>From which renewables sources is this energy coming from? Figure 6 below shows this below. This graph is sort of similar in design to Figure 2, but uses both axes to represent the % share, instead of just the x axis.</p><p>In this graph we can also see the countries getting their renewable energy from each source. For example, we can see that a lot of countries are dominated by solid biofuels (Poland, Latvia, Finland), whereas others have a more diverse supply (Germany, Italy, Spain, France). It’s also not suprising to see a low % of solar in Nordic countries (Sweden, Finland), where they only get about 6 hours of sunlight in the winter, compared to sunnier more solar-panel-friendly Southern and Central European Nations (Spain, Netherlands, Greece, Cyprus).</p><p>Italy has the largest share of geothermal in it’s renewable energy mix, while Ireland has the largest share and majority of it’s renewable energy coming from wind. Cyprus has the highest share of solar, and similarly Slovenia the higest for hydroelectric, Luxembourg for liquid biofuels and Germany for biogas.</p><p><img src=\"/assets/images/a-few-charts-on-eu-energy/ren-tree-facet4-01.png\" alt=\"\" /><em>Figure 4: Who Uses What Renewables</em></p><p>Figure x shows the growth of the number of wind and solar power plants in Europe from 2000 to 2020. This chart shows the smaller installed capacity of solar compared to wind as well as the differences in distribution of wind and solar power plants (e.g Sweden &amp; Finland have a lot of wind plants but no solar plants or how Spanish wind plants are mostly in the north of the country and solar plants in the south). It also shows that wind power plants generally started operating earlier than solar, due to technology differences (this might also be partly because of the higher MW cutoff point in the solar database).</p><p><img src=\"/assets/images/a-few-charts-on-eu-energy/ren-ws-map4-01.png\" alt=\"\" /><em>Figure 5: The Growth of Solar and Wind Power</em></p><!---### Russian ImportsThe EU's dependency on Russian energy imports is also interesting to consider as this has been brought into the news again by the Russia-Ukraine conflict, which has led to skyrocketing gas prices and warnings of energy rationing across the continent later this year. Figure 7 shows the % of each country's gas coming from Russia compared to other sources, and gas as a % of TES.Countries like Latvia, Hungary, Slovakia and Austria look to be the most dependent on russian imports as they have a high % of gas coming from Russia and relatively high % of gas in their energy mix. At the other end of the scale, nations including Denmark, Spain, Portugal and France seem relatively insulated from Russia in theory - although they can still be impacted by higher energy prices in the EU energy market from demand outpacing supply in other countries.<!---research this more.https://www.cpb.nl/sites/default/files/omnidownload/CPB-Publication-Analysis-of-international-trade-sanctions-against-Russia.pdfhttps://app.powerbi.com/view?r=eyJrIjoiMjJmYWQ4NjctYWIwNC00NzNjLWI5MmMtODVmOTQ0M2Q5YmI4IiwidCI6ImU2MjZkOTBjLTcwYWUtNGRmYy05NmJhLTAyZjE4Y2MwMDA3ZSIsImMiOjl9adjust this graph sadly to only show russia and other sources - as the data is otherwise not accurate - ![](/assets/images/a-few-charts-on-eu-energy/gas_facet1-01.png)--->",
            "url": "http://localhost:4000/2022/07/16/a-few-charts-on-eu-energy",
            
            
            
            
            
            "date_published": "2022-07-16T00:00:00+01:00",
            "date_modified": "2022-07-16T00:00:00+01:00",
            
                "author": 
                "{"twitter"=>nil, "name"=>nil, "avatar"=>nil, "email"=>nil, "url"=>nil}"
                
            
        },
    
        {
            "id": "http://localhost:4000/2022/06/24/mapping-uk-house-prices-in-r",
            "title": "Mapping English and Welsh House Prices in R",
            "summary": "Mapping English and Welsh House Prices in R",
            "content_text": "IntroductionHouse prices are constantly in the news, however, basically all the news stories I’ve read about this topic don’t focus on very granular data - instead talking about the country overall, or dividing prices by region and perhaps doing a deep dive into a specific locality. The focus of the post is to therefore look at house prices nationally - at a very local level. This should 1) hopefully show some interesting trends and 2) allow me to learn a bit about making interactive maps in R.DataThe data on house prices was taken from the May release of the “Prices Paid” dataset, collected by HM Land Registry. This is a dataset of all registered property sales in England &amp; Wales from 1995 to the present day. It contains information on the price paid for each property as well as the postcode, address and other info (e.g. property type, new build/old build). Ideally, I wanted to get data for the whole of the UK, but Scotland does not provide this data in an easily accessible manner (as far as I know) and any property data for Northern Ireland apparently requires a paid license to access, so I was left with just English and Welsh data.To map this data, I needed to match the postcodes to geographic coordinates and geographic areas. I used the ONS National Postcode Lookup to do this. The Postcode Lookup details every postcode in the UK and their associated latitude/longitude as well as the geographic areas that they belong to (e.g. Local Authority District, Middle Super Output Area).Some other important datasets I needed for creating some of the maps were the shapefiles for the geographic areas I wanted to look at, which were also from the ONS.One final dataset is from the House of Commons (HoC) Library. For Middle Super Output Areas (MSOA) - which is an area type I wanted to visualise, they generally don’t have names and are just named based on their local authority district (e.g. Great Yarmouth 1, Great Yarmouth 2), however the HoC Library has devised actual descriptive names for these areas (e.g. Hemsby &amp; Oremsby, Fleggburgh/ Rollesby &amp; Martham), which are a bit nicer for presenting and analysing the data at a MSOA level.General MethodDue to reporting time lags, it’s generally not best practice to look at data from the last few months, so I only looked at data up to March 2022. This should hopefully reduce the impact of reporting lags, while also providing fairly up to date figures.Additionally, because I am drilling down into rather small areas, just using sales from March 2022 would lead to a very small sample size for a lot of areas, which wouldn’t be very accurate. So I decided to look at the median price over the whole year for each area (March 2021 - March 2022). I didn’t adjust for property type mix as a lot of house price indexes do, instead opting to look at the unadjusted values.I also decided to bin the price/sale values for colouring the maps, as I think it makes it easier to visually interpret the difference in price between areas. The bins I used were generally not equal width, but instead were somewhat similar to log scales, where larger values had larger bins, to reduce the total number of bins, while not crowding out the lower prices areas like a continuous scale would. The colour scales used were from the scico and viridis packages, which are perceptually uniform and colourblind friendly, making them good for this sort of visualisation.To make the maps interactive, I used the Leaflet package in R, which is build on top of the Leaflet JavaScript library. There are quite a lot of interesting features in this package that I tried to make the most of, e.g. adding dynamic lables, using multiple basemaps to show location labels on top of the polygon layers and having multiple polygon layers that are visible at different zoom levels.Chloropleth mapsThe first map type I looked at was a chloropleth, shown below. The map initially shows median house prices and the number of sales at a Local Authority District (LAD) level of granularity. However if you zoom in, it will break the LADs down to MSOAs (essentially one layer below - ignoring wards as they don’t match perfectly). This allows you to get a broader and less crowded view at the national level and still explore regional variations at a high level of granularity.       Click here for the code that was used to generate this map       chloropleth &lt;- leaflet() %&gt;%          setView(lng = -0.5, lat = 53.25, zoom = 6.00) %&gt;%         addMapPane(\"background\", zIndex = 100) %&gt;%         addMapPane(\"data\", zIndex = 101) %&gt;%         addMapPane(\"labels\", zIndex = 102) %&gt;%         addProviderTiles(providers$CartoDB.PositronNoLabels,                             options = providerTileOptions(pane = \"background\", minZoom = 6)) %&gt;%         addPolygons(data = msoa_leaflet_change,fillColor = ~pal_scico(msoa_leaflet_change$price_bins_post), stroke = TRUE, color = \"white\",weight = 0.75, fillOpacity = 0.75,                    label = labels, group = \"x\", options = pathOptions(pane = \"data\")) %&gt;%         addPolygons(data = lad_leaflet_change, fillColor = ~pal_scico(lad_leaflet_change$price_bins_post), stroke = TRUE, color = \"white\",weight = 0.75, fillOpacity = 0.75,                    group = \"y\", label = labels_x, options = pathOptions(pane = \"data\")) %&gt;%         addProviderTiles(providers$CartoDB.PositronOnlyLabels,                             options = providerTileOptions(pane = \"labels\",minZoom = 6)) %&gt;%         groupOptions(\"x\", zoomLevels = 11:20) %&gt;%         groupOptions(\"y\", zoomLevels = 0:10) %&gt;%         addLegend(title = \"Median Price\", \"bottomright\", pal = pal_scico, values = c(\"0-150k\", \"150k-250k\", \"250k-350k\", \"350k-450k\",\"450k-550k\", \"550k-750k\", \"750k-1m\", \"Above 1m\")) %&gt;%         addFullscreenControl()    saveWidget(chloropleth, \"Widgets/chloropleth3.html\")  Grid mapsThere is also an st_make_grid() function in the sf package that can be used to divide an area into equal sized grid squares and then summarise the data within each grid square.The grid squares I used are supposedly 25km^2 for the England and Wales maps and 0.75km^2 for the London map (see both below). Leaflet uses the Web Mercator (3875) coordinate referencing system (CRS) to display maps, which essentially flattens maps to make them look nice for the web. However, it does this at the expense of accurate distances, which gets worse the further you move from the equator. This makes me question how accurate these grid square sizes are. It would probably be better to use a CRS like the UK National Grid (27700), which does not distort distances like the Web Mercator CRS, but leaflet doesn’t support this, atleast not if you want to use pretty basemaps.In any case, these grid squares can be used to create quite detailed maps of house prices and house sales. The main differences compared to chloropleth maps are that grid maps don’t say anything about population density/property density and because of this there are quite a lot of grid-squares with just a few observations, which may impact the reliability of the presented median prices. At the same time, using equally sized grid-squares does allow for a more granular view of the actual house prices and sales across the country, which can reveal insight which may have been hidden by using other map types. e.g. you can see a few grid squares with very highly priced properties but only 1 or 2 sales above Erith in the London map below.Below you can see maps of the UK, coloured firstly by property price and secondly by number of sales.        I also created a grid map just for London, as London is notorious for it’s (regional) inequalities. I therefore thought it would be interesting to visualise it individually. I also used different price bins to better represent London’s property market, so the colours are different to the other price maps to avoid confusion.    Point-grid mapsAdditionally, the st_centroid() function can be used to find the centre of each grid-square. From this we can create what I’ve called “point-grid” maps (not sure if there is an actual name for this kind of map, but I have seen some other examples). These maps can use both colour and size scales to show both total sales and median price, which isn’t shown in the other maps here. The drawback of this type of map is that it can become harder to see the individual points in high turnover area e.g. London or Birmingham, due to overlapping points - although a log size scale can somewhat fix this.See a point-grid map for the UK below, using a logged size scale.    ",
            "content_html": "<h3 id=\"introduction\">Introduction</h3><p>House prices are constantly in the news, however, basically all the news stories I’ve read about this topic don’t focus on very granular data - instead talking about the country overall, or dividing prices by region and perhaps doing a deep dive into a specific locality. The focus of the post is to therefore look at house prices nationally - at a very local level. This should 1) hopefully show some interesting trends and 2) allow me to learn a bit about making interactive maps in R.</p><h3 id=\"data\">Data</h3><p>The data on house prices was taken from the May release of the “Prices Paid” dataset, collected by HM Land Registry. This is a dataset of all registered property sales in England &amp; Wales from 1995 to the present day. It contains information on the price paid for each property as well as the postcode, address and other info (e.g. property type, new build/old build). Ideally, I wanted to get data for the whole of the UK, but Scotland does not provide this data in an easily accessible manner (as far as I know) and any property data for Northern Ireland apparently requires a paid license to access, so I was left with just English and Welsh data.</p><p>To map this data, I needed to match the postcodes to geographic coordinates and geographic areas. I used the ONS National Postcode Lookup to do this. The Postcode Lookup details every postcode in the UK and their associated latitude/longitude as well as the geographic areas that they belong to (e.g. Local Authority District, Middle Super Output Area).</p><p>Some other important datasets I needed for creating some of the maps were the shapefiles for the geographic areas I wanted to look at, which were also from the ONS.</p><p>One final dataset is from the House of Commons (HoC) Library. For Middle Super Output Areas (MSOA) - which is an area type I wanted to visualise, they generally don’t have names and are just named based on their local authority district (e.g. Great Yarmouth 1, Great Yarmouth 2), however the HoC Library has devised actual descriptive names for these areas (e.g. Hemsby &amp; Oremsby, Fleggburgh/ Rollesby &amp; Martham), which are a bit nicer for presenting and analysing the data at a MSOA level.</p><h3 id=\"general-method\">General Method</h3><p>Due to reporting time lags, it’s generally not best practice to look at data from the last few months, so I only looked at data up to March 2022. This should hopefully reduce the impact of reporting lags, while also providing fairly up to date figures.</p><p>Additionally, because I am drilling down into rather small areas, just using sales from March 2022 would lead to a very small sample size for a lot of areas, which wouldn’t be very accurate. So I decided to look at the median price over the whole year for each area (March 2021 - March 2022). I didn’t adjust for property type mix as a lot of house price indexes do, instead opting to look at the unadjusted values.</p><p>I also decided to bin the price/sale values for colouring the maps, as I think it makes it easier to visually interpret the difference in price between areas. The bins I used were generally not equal width, but instead were somewhat similar to log scales, where larger values had larger bins, to reduce the total number of bins, while not crowding out the lower prices areas like a continuous scale would. The colour scales used were from the scico and viridis packages, which are perceptually uniform and colourblind friendly, making them good for this sort of visualisation.</p><p>To make the maps interactive, I used the Leaflet package in R, which is build on top of the Leaflet JavaScript library. There are quite a lot of interesting features in this package that I tried to make the most of, e.g. adding dynamic lables, using multiple basemaps to show location labels on top of the polygon layers and having multiple polygon layers that are visible at different zoom levels.</p><h4 id=\"chloropleth-maps\">Chloropleth maps</h4><p>The first map type I looked at was a chloropleth, shown below. The map initially shows median house prices and the number of sales at a Local Authority District (LAD) level of granularity. However if you zoom in, it will break the LADs down to MSOAs (essentially one layer below - ignoring wards as they don’t match perfectly). This allows you to get a broader and less crowded view at the national level and still explore regional variations at a high level of granularity.</p><div style=\"width:100%;border:none\"><iframe src=\"/assets/widgets/house-prices/chloropleth3.html\" width=\"100%\" height=\"500px\" frameborder=\"0\"></iframe>    </div><details>  <summary> Click here for the code that was used to generate this map </summary>  <div class=\"language-r highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"w\">    </span><span class=\"n\">chloropleth</span><span class=\"w\"> </span><span class=\"o\">&lt;-</span><span class=\"w\"> </span><span class=\"n\">leaflet</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">%&gt;%</span><span class=\"w\">          </span><span class=\"n\">setView</span><span class=\"p\">(</span><span class=\"n\">lng</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">-0.5</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">lat</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">53.25</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">zoom</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">6.00</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">%&gt;%</span><span class=\"w\">         </span><span class=\"n\">addMapPane</span><span class=\"p\">(</span><span class=\"s2\">\"background\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">zIndex</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">100</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">%&gt;%</span><span class=\"w\">         </span><span class=\"n\">addMapPane</span><span class=\"p\">(</span><span class=\"s2\">\"data\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">zIndex</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">101</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">%&gt;%</span><span class=\"w\">         </span><span class=\"n\">addMapPane</span><span class=\"p\">(</span><span class=\"s2\">\"labels\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">zIndex</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">102</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">%&gt;%</span><span class=\"w\">         </span><span class=\"n\">addProviderTiles</span><span class=\"p\">(</span><span class=\"n\">providers</span><span class=\"o\">$</span><span class=\"n\">CartoDB.PositronNoLabels</span><span class=\"p\">,</span><span class=\"w\">                             </span><span class=\"n\">options</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">providerTileOptions</span><span class=\"p\">(</span><span class=\"n\">pane</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"background\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">minZoom</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">6</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">%&gt;%</span><span class=\"w\">         </span><span class=\"n\">addPolygons</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">msoa_leaflet_change</span><span class=\"p\">,</span><span class=\"n\">fillColor</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">~</span><span class=\"n\">pal_scico</span><span class=\"p\">(</span><span class=\"n\">msoa_leaflet_change</span><span class=\"o\">$</span><span class=\"n\">price_bins_post</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">stroke</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">TRUE</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"white\"</span><span class=\"p\">,</span><span class=\"n\">weight</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.75</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fillOpacity</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.75</span><span class=\"p\">,</span><span class=\"w\">                    </span><span class=\"n\">label</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">labels</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">group</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"x\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">options</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">pathOptions</span><span class=\"p\">(</span><span class=\"n\">pane</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"data\"</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">%&gt;%</span><span class=\"w\">         </span><span class=\"n\">addPolygons</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">lad_leaflet_change</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fillColor</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">~</span><span class=\"n\">pal_scico</span><span class=\"p\">(</span><span class=\"n\">lad_leaflet_change</span><span class=\"o\">$</span><span class=\"n\">price_bins_post</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">stroke</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kc\">TRUE</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"white\"</span><span class=\"p\">,</span><span class=\"n\">weight</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.75</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">fillOpacity</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0.75</span><span class=\"p\">,</span><span class=\"w\">                    </span><span class=\"n\">group</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"y\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">label</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">labels_x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">options</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">pathOptions</span><span class=\"p\">(</span><span class=\"n\">pane</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"data\"</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">%&gt;%</span><span class=\"w\">         </span><span class=\"n\">addProviderTiles</span><span class=\"p\">(</span><span class=\"n\">providers</span><span class=\"o\">$</span><span class=\"n\">CartoDB.PositronOnlyLabels</span><span class=\"p\">,</span><span class=\"w\">                             </span><span class=\"n\">options</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">providerTileOptions</span><span class=\"p\">(</span><span class=\"n\">pane</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"labels\"</span><span class=\"p\">,</span><span class=\"n\">minZoom</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">6</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">%&gt;%</span><span class=\"w\">         </span><span class=\"n\">groupOptions</span><span class=\"p\">(</span><span class=\"s2\">\"x\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">zoomLevels</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">11</span><span class=\"o\">:</span><span class=\"m\">20</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">%&gt;%</span><span class=\"w\">         </span><span class=\"n\">groupOptions</span><span class=\"p\">(</span><span class=\"s2\">\"y\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">zoomLevels</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"m\">0</span><span class=\"o\">:</span><span class=\"m\">10</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">%&gt;%</span><span class=\"w\">         </span><span class=\"n\">addLegend</span><span class=\"p\">(</span><span class=\"n\">title</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"Median Price\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"bottomright\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">pal</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">pal_scico</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">values</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">c</span><span class=\"p\">(</span><span class=\"s2\">\"0-150k\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"150k-250k\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"250k-350k\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"350k-450k\"</span><span class=\"p\">,</span><span class=\"s2\">\"450k-550k\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"550k-750k\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"750k-1m\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"Above 1m\"</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"o\">%&gt;%</span><span class=\"w\">         </span><span class=\"n\">addFullscreenControl</span><span class=\"p\">()</span><span class=\"w\">    </span><span class=\"n\">saveWidget</span><span class=\"p\">(</span><span class=\"n\">chloropleth</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"Widgets/chloropleth3.html\"</span><span class=\"p\">)</span><span class=\"w\"></span></code></pre></div>  </div></details><p><br /></p><h4 id=\"grid-maps\">Grid maps</h4><p>There is also an <code class=\"language-plaintext highlighter-rouge\">st_make_grid()</code> function in the sf package that can be used to divide an area into equal sized grid squares and then summarise the data within each grid square.</p><p>The grid squares I used are supposedly 25km^2 for the England and Wales maps and 0.75km^2 for the London map (see both below). Leaflet uses the Web Mercator (3875) coordinate referencing system (CRS) to display maps, which essentially flattens maps to make them look nice for the web. However, it does this at the expense of accurate distances, which gets worse the further you move from the equator. This makes me question how accurate these grid square sizes are. It would probably be better to use a CRS like the UK National Grid (27700), which does not distort distances like the Web Mercator CRS, but leaflet doesn’t support this, atleast not if you want to use pretty basemaps.</p><p>In any case, these grid squares can be used to create quite detailed maps of house prices and house sales. The main differences compared to chloropleth maps are that grid maps don’t say anything about population density/property density and because of this there are quite a lot of grid-squares with just a few observations, which may impact the reliability of the presented median prices. At the same time, using equally sized grid-squares does allow for a more granular view of the actual house prices and sales across the country, which can reveal insight which may have been hidden by using other map types. e.g. you can see a few grid squares with very highly priced properties but only 1 or 2 sales above Erith in the London map below.</p><p>Below you can see maps of the UK, coloured firstly by property price and secondly by number of sales.</p><div style=\"width:100%;border:none\"><iframe src=\"/assets/widgets/house-prices/price_grid2.html\" width=\"100%\" height=\"500px\" frameborder=\"0\"></iframe>    </div><div style=\"width:100%;border:none\"><iframe src=\"/assets/widgets/house-prices/sales_grid4.html\" width=\"100%\" height=\"500px\" frameborder=\"0\"></iframe>    </div><p>I also created a grid map just for London, as London is notorious for it’s (regional) inequalities. I therefore thought it would be interesting to visualise it individually. I also used different price bins to better represent London’s property market, so the colours are different to the other price maps to avoid confusion.</p><div style=\"width:100%;border:none\"><iframe src=\"/assets/widgets/house-prices/london_grid2.html\" width=\"100%\" height=\"500px\" frameborder=\"0\"></iframe>    </div><h4 id=\"point-grid-maps\">Point-grid maps</h4><p>Additionally, the <code class=\"language-plaintext highlighter-rouge\">st_centroid()</code> function can be used to find the centre of each grid-square. From this we can create what I’ve called “point-grid” maps (not sure if there is an actual name for this kind of map, but I have seen some other examples). These maps can use both colour and size scales to show both total sales and median price, which isn’t shown in the other maps here. The drawback of this type of map is that it can become harder to see the individual points in high turnover area e.g. London or Birmingham, due to overlapping points - although a log size scale can somewhat fix this.</p><p>See a point-grid map for the UK below, using a logged size scale.</p><div style=\"width:100%;border:none\"><iframe src=\"/assets/widgets/house-prices/log_point_grid4.html\" width=\"100%\" height=\"500px\" frameborder=\"0\"></iframe>    </div>",
            "url": "http://localhost:4000/2022/06/24/mapping-uk-house-prices-in-r",
            
            
            
            "tags": ["R","Leaflet"],
            
            "date_published": "2022-06-24T00:00:00+01:00",
            "date_modified": "2022-06-24T00:00:00+01:00",
            
                "author": 
                "{"twitter"=>nil, "name"=>nil, "avatar"=>nil, "email"=>nil, "url"=>nil}"
                
            
        }
    
    ]
}