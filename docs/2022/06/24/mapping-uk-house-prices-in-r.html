<!DOCTYPE html><html lang="en" ><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Mapping English and Welsh House Prices in R" /><meta property="og:locale" content="en_US" /><meta name="description" content="Mapping English and Welsh House Prices in R" /><meta property="og:description" content="Mapping English and Welsh House Prices in R" /><link rel="canonical" href="http://localhost:4000/2022/06/24/mapping-uk-house-prices-in-r" /><meta property="og:url" content="http://localhost:4000/2022/06/24/mapping-uk-house-prices-in-r" /><meta property="og:site_name" content="Scott’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-24T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Mapping English and Welsh House Prices in R" /><meta name="twitter:site" content="@" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-24T00:00:00+01:00","datePublished":"2022-06-24T00:00:00+01:00","description":"Mapping English and Welsh House Prices in R","headline":"Mapping English and Welsh House Prices in R","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2022/06/24/mapping-uk-house-prices-in-r"},"url":"http://localhost:4000/2022/06/24/mapping-uk-house-prices-in-r"}</script><title> Mapping English and Welsh House Prices in R - Scott&#39;s Blog</title><link rel="shortcut icon" href="/favicon.png"><link rel="alternate" type="application/atom+xml" title="Scott's Blog" href="/atom.xml"><link rel="alternate" type="application/json" title="Scott's Blog" href="http://localhost:4000/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="/sitemap.xml" /><link href="/assets/css/syntax.css" rel="stylesheet" ><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:roboto;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.5;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code{padding:.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:2rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}figcaption{font-size:smaller}</style></head><body><main role="main"><header role="banner"> <!--<h1 class="logo">Scott's Blog</h1>--><nav role="navigation"><ul><li><a href="/" >Posts</a></li><li><a href="/about" >About</a></li><li><a href="/search" >Search</a></li></ul></nav></header><section class="post"><h2>Mapping English and Welsh House Prices in R</h2><h3 id="introduction">Introduction</h3><p>House prices are constantly in the news, however, basically all the news stories I’ve read about this topic don’t focus on very granular data - instead talking about the country overall, or dividing prices by region and perhaps doing a deep dive into a specific locality. The focus of the post is to therefore look at house prices nationally - at a very local level. This should 1) hopefully show some interesting trends and 2) allow me to learn a bit about making interactive maps in R.</p><h3 id="data">Data</h3><p>The data on house prices was taken from the May release of the “Prices Paid” dataset, collected by HM Land Registry. This is a dataset of all registered property sales in England &amp; Wales from 1995 to present. It contains information on the price paid for each property as well as the postcode, address and other info (e.g. property type, new build/old build). Ideally, I wanted to get data for the whole of the UK, but Scotland does not provide this data in an easily accessible manner (as far as I know) and any property data for Northern Ireland apparently requires a paid license to access, so I was left with just English and Welsh data.</p><p>To map this data, I needed to match the postcodes to geographic coordinates and geographic areas. I used the ONS National Postcode Lookup to do this. The Postcode Lookup details every postcode in the UK and their associated latitude/longitude as well as the geographic areas that they belong to (e.g. Local Authority District, Middle Super Output Area).</p><p>Some other important datasets I needed for creating some of the maps were the shapefiles for the geographic areas I wanted to look at, which were also from the ONS.</p><p>One final dataset is from the House of Commons (HoC) Library. For Middle Super Output Areas (MSOA) - which is an area type I wanted to visualise, they generally don’t have names and are just named based on their local authority district (e.g. Great Yarmouth 1, Great Yarmouth 2), however the HoC Library has devised actual descriptive names for these areas (e.g. Hemsby &amp; Oremsby, Fleggburgh/ Rollesby &amp; Martham), which are a bit nicer for presenting and analysing the data at a MSOA level.</p><h3 id="general-method">General Method</h3><p>Due to reporting time lags, it’s generally not best practice to look at data from the last few months, so I only looked at data up to March 2022. This should hopefully reduce the impact of reporting lags, while also providing fairly up to date figures.</p><p>Additionally, because I am drilling down into rather small areas, just using sales from March 2022 would lead to a very small sample size for a lot of areas, which wouldn’t be very accurate. So I decided to look at the median price over the whole year for each area (March 2021 - March 2022). I didn’t adjust for property type mix as a lot of house price indexes do, instead opting to look at the unadjusted values.</p><p>I also decided to bin the price/sale values for colouring the maps, as I think it makes it easier to visually interpret the difference in price between areas. The bins I used were generally not equal width, but instead were somewhat similar to log scales, where larger values had larger bins, to reduce the total number of bins, while not crowding out the lower prices areas like a continuous scale would. The colour scales used were from the scico and viridis packages, which are perceptually uniform and colourblind friendly, making them good for this sort of visualisation.</p><p>To make the maps interactive, I used the Leaflet package in R, which is build on top of the Leaflet JavaScript library. There are quite a lot of interesting features in this package that I tried to make the most of, e.g. adding dynamic lables, using multiple basemaps to show location labels on top of the polygon layers and having multiple polygon layers that are visible at different zoom levels.</p><h4 id="chloropleth-maps">Chloropleth maps</h4><p>The first map type I looked at was a chloropleth, shown below. The map initially shows median house prices and the number of sales at a Local Authority District (LAD) level of granularity. However if you zoom in, it will break the LADs down to MSOAs (essentially one layer below - ignoring wards as they don’t match perfectly). This allows you to get a broader and less crowded view at the national level and still explore regional variations at a high level of granularity.</p><div style="width:100%;border:none"><iframe src="/assets/widgets/house-prices/chloropleth2.html" width="100%" height="500px" frameborder="0"></iframe></div><details> <summary> Click here for the code that was used to generate this map </summary><div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">    </span><span class="n">chloropleth</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="n">leaflet</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  
        </span><span class="n">setView</span><span class="p">(</span><span class="n">lng</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-0.5</span><span class="p">,</span><span class="w"> </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">53.25</span><span class="p">,</span><span class="w"> </span><span class="n">zoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6.00</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
        </span><span class="n">addMapPane</span><span class="p">(</span><span class="s2">"background"</span><span class="p">,</span><span class="w"> </span><span class="n">zIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
        </span><span class="n">addMapPane</span><span class="p">(</span><span class="s2">"data"</span><span class="p">,</span><span class="w"> </span><span class="n">zIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">101</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
        </span><span class="n">addMapPane</span><span class="p">(</span><span class="s2">"labels"</span><span class="p">,</span><span class="w"> </span><span class="n">zIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">102</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
        </span><span class="n">addProviderTiles</span><span class="p">(</span><span class="n">providers</span><span class="o">$</span><span class="n">CartoDB.PositronNoLabels</span><span class="p">,</span><span class="w"> 
                            </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">providerTileOptions</span><span class="p">(</span><span class="n">pane</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"background"</span><span class="p">,</span><span class="w"> </span><span class="n">minZoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
        </span><span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msoa_leaflet_change</span><span class="p">,</span><span class="n">fillColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">pal</span><span class="p">(</span><span class="n">msoa_leaflet_change</span><span class="o">$</span><span class="n">price_bins_post</span><span class="p">),</span><span class="w"> </span><span class="n">stroke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.75</span><span class="p">,</span><span class="w"> </span><span class="n">fillOpacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.75</span><span class="p">,</span><span class="w">
                    </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labels</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pathOptions</span><span class="p">(</span><span class="n">pane</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
        </span><span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lad_leaflet_change</span><span class="p">,</span><span class="w"> </span><span class="n">fillColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">pal</span><span class="p">(</span><span class="n">lad_leaflet_change</span><span class="o">$</span><span class="n">price_bins_post</span><span class="p">),</span><span class="w"> </span><span class="n">stroke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.75</span><span class="p">,</span><span class="w"> </span><span class="n">fillOpacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.75</span><span class="p">,</span><span class="w">
                    </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labels_x</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pathOptions</span><span class="p">(</span><span class="n">pane</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
        </span><span class="n">addProviderTiles</span><span class="p">(</span><span class="n">providers</span><span class="o">$</span><span class="n">CartoDB.PositronOnlyLabels</span><span class="p">,</span><span class="w"> 
                            </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">providerTileOptions</span><span class="p">(</span><span class="n">pane</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"labels"</span><span class="p">,</span><span class="n">minZoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
        </span><span class="n">groupOptions</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="n">zoomLevels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">11</span><span class="o">:</span><span class="m">20</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
        </span><span class="n">groupOptions</span><span class="p">(</span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="n">zoomLevels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="o">:</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
        </span><span class="n">addLegend</span><span class="p">(</span><span class="s2">"bottomright"</span><span class="p">,</span><span class="w"> </span><span class="n">pal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pal</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"0-150k"</span><span class="p">,</span><span class="w"> </span><span class="s2">"150k-250k"</span><span class="p">,</span><span class="w"> </span><span class="s2">"250k-350k"</span><span class="p">,</span><span class="w"> </span><span class="s2">"350k-450k"</span><span class="p">,</span><span class="w"> </span><span class="s2">"450k-750k"</span><span class="p">,</span><span class="w"> </span><span class="s2">"750k-1m"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Above 1m"</span><span class="p">))</span><span class="w">
    </span><span class="n">saveWidget</span><span class="p">(</span><span class="n">chloropleth</span><span class="p">,</span><span class="w"> </span><span class="s2">"Widgets/chloropleth.html"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div></details><p><br /></p><h4 id="grid-maps">Grid maps</h4><p>There is also an <code class="language-plaintext highlighter-rouge">st_make_grid()</code> function in the sf package that can be used to divide an area into equal sized grid squares and then summarise the data within each grid square.</p><p>The grid squares I used are supposedly 25km^2 for the England and Wales maps and 0.75km^2 for the London map (see both below). Leaflet uses the Web Mercator (3875) coordinate referencing system (CRS) to display maps, which essentially flattens maps to make them look nice for the web. However, it does this at the expense of accurate distances, which gets worse the further you move from the equator. This makes me question how accurate these grid square sizes are. It would probably be better to use a CRS like the UK National Grid (27700), which does not distort distances like the Web Mercator CRS, but leaflet doesn’t support this, atleast not if you want to use pretty basemaps.</p><p>In any case, these grid squares can be used to create quite detailed maps of house prices and house sales. The main differences compared to chloropleth maps are that grid maps don’t say anything about population density/property density and because of this there are quite a lot of grid-squares with just a few observations, which may impact the reliability of the presented median prices. At the same time, using equally sized grid-squares does allow for a more granular view of the actual house prices and sales across the country, which can reveal insight which may have been hidden by using other map types. e.g. you can see a few grid squares with very highly priced properties but only 1 or 2 sales above Erith in the London map below.</p><p>Below you can see maps of the UK, coloured firstly by property price and secondly by number of sales.</p><div style="width:100%;border:none"><iframe src="/assets/widgets/house-prices/price_grid2.html" width="100%" height="500px" frameborder="0"></iframe></div><div style="width:100%;border:none"><iframe src="/assets/widgets/house-prices/sales_grid4.html" width="100%" height="500px" frameborder="0"></iframe></div><p>I also created a grid map just for London, as London has a high population (~8.9 million) and a whole bunch of regional inequalities. I therefore thought it would be interesting to visualise it individually. I also used different price bins to better represent London’s property market, which is why the colours are different to the other price maps.</p><div style="width:100%;border:none"><iframe src="/assets/widgets/house-prices/london_grid2.html" width="100%" height="500px" frameborder="0"></iframe></div><h4 id="point-grid-maps">Point-grid maps</h4><p>Additionally, the <code class="language-plaintext highlighter-rouge">st_centroid()</code> function can be used to find the centre of each grid-square. From this we can create what I’ve called “point-grid” maps (not sure if there is an actual name for this kind of map, but I have seen some other examples). These maps can use both colour and size scales to show both total sales and median price, which isn’t shown in the other maps here. The drawback of this type of map is that it can become harder to see the individual points in high turnover area e.g. London or Birmingham, due to overlapping points - although a log size scale can somewhat fix this.</p><p>See a point-grid map for the UK below, using a logged size scale.</p><div style="width:100%;border:none"><iframe src="/assets/widgets/house-prices/log_point_grid2.html" width="100%" height="500px" frameborder="0"></iframe></div><h4 id="static-maps">Static maps</h4><p>Finally, I also put together a static map at the MSOA level for my own amusement:</p><p><img src="/assets/images/house-prices/Total Plot v6-01.png" alt="" /></p><span class="meta"><time datetime="2022-06-24T00:00:00+01:00">June 24, 2022</time> &middot; <a href="/tag/R">R</a>, <a href="/tag/Leaflet">Leaflet</a></span></section></main></body></html>
